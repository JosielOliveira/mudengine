version: '3.6'
services:
  mud-world:
    build:
      context: ../../mud-world/
      dockerfile: ./Dockerfile  
    image: mudengine/mud-world
    deploy:
      replicas: 1
    ports:
      - 8082:8080
    environment:
      - spring.profiles.active
      - CONFIG_SERVER_URL
      - EUREKA_SERVER_URL
      - EXPOSED_HOST
      - EXPOSED_PORT=8082
    networks:
      - app_net
    depends_on:
      - mud-config
      - mud-registry
  mud-item:
    build:
      context: ../../mud-item/
      dockerfile: ./Dockerfile  
    image: mudengine/mud-item
    deploy:
      replicas: 1
    ports:
      - 8084:8080
    environment:
      - spring.profiles.active
      - CONFIG_SERVER_URL
      - EUREKA_SERVER_URL
      - EXPOSED_HOST
      - EXPOSED_PORT=8084
    networks:
      - app_net
    depends_on:
      - mud-config
      - mud-registry
  mud-being:
    build:
      context: ../../mud-being/
      dockerfile: ./Dockerfile  
    image: mudengine/mud-being
    deploy:
      replicas: 1
    ports:
      - 8086:8080
    environment:
      - spring.profiles.active
      - CONFIG_SERVER_URL
      - EUREKA_SERVER_URL
      - EXPOSED_HOST
      - EXPOSED_PORT=8086
    networks:
      - app_net
    depends_on:
      - mud-config
      - mud-registry
  mud-message:
    build:
      context: ../../mud-message/
      dockerfile: ./Dockerfile  
    image: mudengine/mud-message
    deploy:
      replicas: 1
    ports:
      - 8088:8080
    environment:
      - spring.profiles.active
      - CONFIG_SERVER_URL
      - EUREKA_SERVER_URL
      - EXPOSED_HOST
      - EXPOSED_PORT=8088
    networks:
      - app_net
    depends_on:
      - mud-config
      - mud-registry
  mud-action:
    build:
      context: ../../mud-action/
      dockerfile: ./Dockerfile  
    image: mudengine/mud-action
    deploy:
      replicas: 1
    ports:
      - 8090:8080
    environment:
      - spring.profiles.active
      - CONFIG_SERVER_URL
      - EUREKA_SERVER_URL
      - EXPOSED_HOST
      - EXPOSED_PORT=8090
    networks:
      - app_net
    depends_on:
      - mud-config
      - mud-registry
  mud-player:
    build:
      context: ../../mud-player/
      dockerfile: ./Dockerfile  
    image: mudengine/mud-player
    deploy:
      replicas: 1
    ports:
      - 8092:8080
    environment:
      - spring.profiles.active
      - CONFIG_SERVER_URL
      - EUREKA_SERVER_URL
      - EXPOSED_HOST
      - EXPOSED_PORT=8092
    networks:
      - app_net
    depends_on:
      - mud-config
      - mud-registry
  mud-config:
    build:
      context: ../../mud-config/
      dockerfile: ./Dockerfile  
    image: mudengine/mud-config
    deploy:
      replicas: 1
    ports:
      - 8888:8888
    environment:
      - spring.profiles.active
      - GIT_USERNAME
      - GIT_PASSWORD
    networks:
      - app_net
  mud-registry:
    build:
      context: ../../mud-registry/
      dockerfile: ./Dockerfile  
    image: mudengine/mud-registry
    deploy:
      replicas: 1
    ports:
      - 8761:8761
    networks:
      - app_net
networks:
  app_net:
    ipam:
      driver: default
      config:
        - subnet: 170.27.0.0/16